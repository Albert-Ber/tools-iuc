<tool id="freyja_aggregate" name="Freyja: Aggregate" version="@TOOL_VERSION@+galaxy@VERSION_SUFFIX@" profile="@PROFILE@">
    <description>
        demixed data
    </description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="biotools"/>
    <expand macro="requirements"/>
    <expand macro="version"/>
    <command detect_errors="exit_code"><![CDATA[
#set demix_dir = 'demix_outputs/'
#set file_paths1 = []
mkdir -p demix_outputs &&
#for $input_file in $demix_file
    #set $file_path = $demix_dir + $input_file.element_identifier
    ln -s '$input_file' '$file_path' &&
    $file_paths1.append($file_path)
#end for
freyja aggregate
    '$demix_dir'
    --output '$aggregated'
    ]]></command>
    <inputs>
        <param name="demix_file" type="data" format="tabular" multiple="true" label="Lineages abundances summary file(s)" help="One file per one sample." />
    </inputs>
    <outputs>
        <data name="aggregated" format="tabular"/>
    </outputs>
    <tests>
        <test expect_num_outputs="1">
            <param name="demix_file" value="abundances.tsv,abundances2.tsv,abundances3.tsv,abundances4.tsv" />
            <output name="aggregated" ftype="tabular">
                <assert_contents>
                    <has_text text="summarized"/>
                    <has_text text="abundances"/>
                    <has_text text="B.1.617.2"/>
                </assert_contents>
            </output>
        </test>
    </tests>
    <help><![CDATA[
@HELP_HEADER@

Information about **freyja aggregate** method
=============================================

Method for manipulating the "demixed" output files. 

Outputs
=======

This resulting aggregated data can analyzed directly as a tsv file, or can be visualized using freyja plot.

    ]]></help>
    <expand macro="citations"/>
</tool>

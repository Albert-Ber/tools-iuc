<tool id="virhunter" name="virhunter" version='1.0.0' >
    <description>
        VirHunter is a deep learning method to identify viruses in sequencing datasets..
    </description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements"/>
    <command detect_errors="exit_code"><![CDATA[
    mkdir -p '${predicted_fragments.extra_files_path}' &&
    pip install tensorflow==2.3.2 &&
    pip install setuptools==63.3.0 &&
    python '$__tool_directory__/predict.py'
        --test_ds '${fasta_file}'
        --weights '${weights.fields.path}'
        --out_path '${predicted_fragments.extra_files_path}'
        --return_viral True
        --limit 750
    && cp '${predicted_fragments.extra_files_path}'/predicted_fragments.csv predicted_fragments.csv
    && cp '${predicted_fragments.extra_files_path}'/predicted.csv predicted.csv
    && cp '${predicted_fragments.extra_files_path}'/viral.fasta viral.fasta

    ]]></command>
    <inputs>
        <param name="fasta_file" type="data" format="fasta" label="DNA FASTA file(s)"/>
        <param name="weights" type="select" label="Select a reference model" help="If your model of interest is not listed, contact the Galaxy team">
            <options from_data_table="virhunter_models">
                <validator type="no_options" message="No models are available for the selected input dataset" />
            </options>
        </param>
    </inputs>
    <outputs>
        <data format="csv" name="predicted_fragments" from_work_dir="predicted_fragments.csv" label="${tool.name} on ${on_string}: predicted fragments"/>
        <data format="csv" name="predicted" from_work_dir="predicted.csv" label="${tool.name} on ${on_string}: predicted "/>
        <data format="fasta" name="viral" from_work_dir="viral.fasta" label="${tool.name} on ${on_string}: viral fasta file" />
    </outputs>
    <tests>
        <test>
            <param name="fasta_file" value="viruses.fasta"/>
            <param name="weights" value="peach"/>
            <output name="predicted_fragments" file="predicted_fragments.csv"  ftype="csv" lines_diff="2"/>
            <output name="predicted" file="predicted.csv"  ftype="csv" lines_diff="2"/>
            <output name="viral" file="viral.fasta"  ftype="fasta" lines_diff="2"/>
        </test>
    </tests>

    <help>
    <![CDATA[
    VirHunter is a deep learning method that uses Convolutional Neural Networks (CNNs) and a Random Forest Classifier to identify viruses in sequening datasets. More precisely, VirHunter classifies previously assembled contigs as viral, host and bacterial (contamination).
 ]]></help>
    <expand macro="citations" />
</tool>
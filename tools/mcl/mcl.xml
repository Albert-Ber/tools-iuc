<tool id="mcl" name="MCL" version="@TOOL_VERSION@+galaxy@VERSION_SUFFIX@" profile="21.05">
    <description>The Markov Cluster Algorithm, a cluster algorithm for graphs</description>
    <macros>
        <token name="@TOOL_VERSION@">14.137</token>
        <token name="@VERSION_SUFFIX@">0</token>
    </macros>
    <xrefs>
        <xref type="bio.tools">mcl</xref>
    </xrefs>
    <requirements>
        <requirement type="package" version="@TOOL_VERSION@">mcl</requirement>
    </requirements>
    <version_command>mcl --version</version_command>
    <command detect_errors="aggressive"><![CDATA[

mcl '$input_type_select.input'
    -I '$inflation'
    '$input_type_select.input_type'
    -V all -te \${GALAXY_SLOTS:-1}
    $sum_loops
    $discard_loops
    #if $verbosity
        #for $v in $verbosity
            -v $v
        #end for
    #end if
    #if $reweight and $reweight != 1.0
        -c $reweight
    #end if
    #if $transform
        #if $input_type_select.input_type == "--abc"
            -abc-tf '$transform'
        #else if $input_type_select.input_type == ""
            -tf '$transform'
        #end if
    #end if
    -o '$output'

    ]]></command>
    <inputs>
        <conditional name="input_type_select">
            <param name="input_type" type="select" label="Input type">
                <option value="--abc" selected="true">Labeled</option>
                <option value="--sif">SIF</option>
                <option value="">Matrix</option>
            </param>
            <when value="">
                <param type="data" format="mclmat" name="input" argument="input" label="Input" optional="false"/>
            </when>
            <when value="--abc">
                <param type="data" format="tabular" name="input" argument="input" label="Input" optional="false"/>
            </when>
            <when value="--sif">
                <param type="data" format="sif" name="input" argument="input" label="Input" optional="false"/>
            </when>
        </conditional>
        <param name="inflation" argument="-I" type="float" value="4.0" label="Inflation"
            help="This value is the main handle for affecting cluster granularity. It is usually chosen somewhere in the range [1.2-5.0]. -I 5.0 will tend to result in fine-grained clusterings, and -I 1.2 will tend to result in very coarse grained clusterings. Your mileage will vary depending on the characteristics of your data. That is why it is a good idea to test the quality and coherency of your clusterings using clm dist and clm info. This will most likely reveal that certain values of -I are simply not right for your data." />
        <param name="transform" type="text" area="true" label="Transform input matrix values"
            help="See https://micans.org/mcl/man/mcxio.html#trans for the transformation syntax" />
        <param argument="--discard-loops" type="boolean" checked="true" truevalue="--discard-loops=y" falsevalue="--discard-loops=n" label="Discard loops in input"
            help="Remove any loops that are present in the input. Bear in mind that loops will still be modified in all cases where the loop weight is not maximal among the list of edge weights for a given node." />
        <param name="sum_loops" type="boolean" checked="false" truevalue="--sum-loops" falsevalue="" argument="--sum-loops"
            label="Set loops to sum of other arcs weights"  />
        <param name="reweight" argument="-c" optional="true" type="float" value="1" label="Reweight loops"
            help="As the final step of loop computation (i.e. after initialization and shadowing) all loop weights are multiplied by the provided value." />
        <param name="verbosity" type="select" multiple="true" optional="true" label="Verbosity">
            <option value="pruning">pruning</option>
            <option value="explain">explain</option>
            <option value="cls">cls</option>
        </param>
    </inputs>
    <outputs>
        <data format="txt" name="output">
            <change_format>
                <when input="input_type_select.input_type" value="" format="mclmat" />
                <when input="input_type_select.input_type" value="--abc" format="tabular" />
                <when input="input_type_select.input_type" value="--sif" format="tabular" />
            </change_format>
        </data>
    </outputs>
    <tests>
        <test expect_num_outputs="1">
            <conditional name="input_type_select">
                <param name="input_type" value="--abc" />
                <param name="input" value="mash-dist.tabular" ftype="tabular" />
            </conditional>
            <param name="transform" value="mul(-1),add(1),gq(0.96)" />
            <output name="output" file="mash-dist-cluster.tabular" ftype="tabular" />
        </test>
    </tests>
    <help>

The `Markov Cluster Algorithm`_, aka the MCL algorithm.

This program implements mcl, a cluster algorithm for graphs. A single parameter controls the granularity of the output clustering, namely the inflation option described further below.
In standard usage of the program this parameter is the only one that may require changing. By default it is set to 2.0 and this is a good way to start. If you want to explore cluster structure in graphs with MCL, vary this parameter to obtain clusterings at different levels of granularity. A good set of starting values is 1.4, 2, 4, and 6.

.. _Markov Cluster Algorithm: https://micans.org/mcl/man/mcl.html

    </help>
    <citations>
        <citation type="doi">10.5281/zenodo.3364789</citation>
        <citation type="bibtex"><![CDATA[
        @article{dongen29graph,
          title={Graph Clustering by Flow Simulation. 2000},
          author={Dongen, SV},
          journal={Domplein},
          volume={29},
          pages={3512}
        }
        ]]></citation>
        <citation type="doi">10.1093/nar/30.7.1575</citation>
    </citations>
</tool>
